<nav class="navbar navbar-fixed-top header">
  <div class="col-md-12">
    <div class="navbar-header">
      <a href="/" class="navbar-brand">
        <img src="/images/KakaoCI.png"/>
      </a>

    </div>
    <ul class="nav navbar-nav navbar-right">
      <li class="active"><a href="/users">멤버 리스트</a></li>
      {{^sessionUser}}
      <li>
        <button class="black-component" onclick="login()">로그인</button>
      </li>
      {{/sessionUser}}
      {{#sessionUser}}
      <li>
        <button class="black-component" onclick="logout()">로그아웃</button>
      </li>
      <li>
        <button class="black-component" onclick="unlink()">탈퇴하기</button>
      </li>
      {{/sessionUser}}
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
      <script type="text/javascript">
        function login() {
          Kakao.Auth.login({
            success: function (response) {
              const accessToken = response.access_token;
              const scope = response.scope;
              console.log('로그인 성공');
              Kakao.API.request({
                url: '/v2/user/me',
                success: function (response) {
                  console.log('사용자 정보 가져오기 성공');
                  axios.post('/users/login', {
                    userId: response.id,
                    password: "password",
                    name: response.properties.nickname,
                    email: response.kakao_account.email,
                    accessToken: accessToken,
                    scope: scope
                  }).then(response => {
                    location.reload();
                  });
                },
                fail: function (error) {
                  console.log('사용자 정보 가져오기 실패');
                  console.log(error);
                }
              });
            },
            fail: function (error) {
              console.log('로그인 실패');
              console.log(error);
            },
          });
        }

        function unlink() {
          console.log('회원 탈퇴');
          Kakao.API.request({
            url: '/v1/user/unlink',
            success: function (response) {
              alert('회원 탈퇴 성공');
              axios.get('/users/unlink').then(response => {
                location.reload();
              });
            },
            fail: function (error) {
              alert('회원 탈퇴 실패');
              console.log(error);
            },
          });
        }

        function logout() {
          console.log('로그아웃');
          if (!Kakao.Auth.getAccessToken()) {
            alert('로그인부터 하세요');
            return;
          }
          Kakao.Auth.logout(function () {
            console.log('로그아웃 성공');
            axios.get('/users/logout').then(response => {
              console.log('callback')
              location.reload();
            });
          });
        }
      </script>
    </ul>
  </div>
</nav>
